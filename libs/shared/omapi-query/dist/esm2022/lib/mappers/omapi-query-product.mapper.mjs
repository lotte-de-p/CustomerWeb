import { Injectable } from '@angular/core';
import { isEmpty, isNil } from 'lodash-es';
import * as i0 from "@angular/core";
export class OmapiQueryProductMapper {
    toModel(rawOmapiQueryProduct) {
        return this.createOmapiQueryProduct(rawOmapiQueryProduct);
    }
    createOmapiQueryProduct(rawOmapiQueryProduct) {
        const omapiQueryProduct = {};
        omapiQueryProduct.products = this.createQueryProducts(rawOmapiQueryProduct.products);
        return omapiQueryProduct;
    }
    createQueryProducts(rawQueryProducts) {
        return (rawQueryProducts &&
            rawQueryProducts.map((rawQueryProduct) => {
                return this.createQueryProductData(rawQueryProduct);
            }));
    }
    createQueryProductData(rawQueryProduct) {
        const queryProduct = {};
        queryProduct.labelKey = rawQueryProduct.labelKey;
        queryProduct.productFamily = rawQueryProduct.productFamily;
        queryProduct.variants = this.createVariants(rawQueryProduct.variants);
        return queryProduct;
    }
    createLocalizedContents(rawLocalizedContents) {
        return (rawLocalizedContents &&
            rawLocalizedContents.map((rawLocalizedContent) => {
                return OmapiQueryProductMapper.createLocalizedContent(rawLocalizedContent);
            }));
    }
    static createLocalizedContent(rawLocalizedContent) {
        const localizedContent = {};
        localizedContent.locale = rawLocalizedContent.locale;
        localizedContent.key = rawLocalizedContent.key;
        localizedContent.data = rawLocalizedContent.data;
        localizedContent.value = OmapiQueryProductMapper.createLocalizedContentValue(rawLocalizedContent.value ? rawLocalizedContent.value : []);
        return localizedContent;
    }
    static createLocalizedContentValue(rawLocalizedContentValue) {
        return (rawLocalizedContentValue &&
            rawLocalizedContentValue.map((value) => {
                return value;
            }));
    }
    createVariants(rawVariants) {
        return (rawVariants &&
            rawVariants.map((rawVariant) => {
                return this.createVariant(rawVariant);
            }));
    }
    createVariant(rawVariant) {
        const variant = {};
        variant.productId = rawVariant.productId;
        if (!isNil(rawVariant.extraAtHomeDelivery)) {
            variant.extraAtHomeDelivery = rawVariant.extraAtHomeDelivery;
        }
        variant.prices = OmapiQueryProductMapper.createPrices(rawVariant.prices);
        variant.images = this.createImages(rawVariant.images);
        const shortDescription = this.createShortDescription(rawVariant.shortDescription);
        if (shortDescription) {
            variant.shortDescription = shortDescription;
        }
        variant.brand = this.createBrand(rawVariant.manBrand);
        return variant;
    }
    static createPrices(rawPrices) {
        const prices = {};
        prices.priceType = rawPrices.priceType;
        return prices;
    }
    createImages(rawImages) {
        return (rawImages &&
            rawImages.map((rawImage) => {
                return this.createImage(rawImage);
            }));
    }
    createImage(rawImage) {
        const image = {};
        image.attributeKey = rawImage.attributeKey;
        image.value = rawImage.value;
        image.localizedContent = this.createLocalizedContents(rawImage.localizedContent);
        return image;
    }
    createShortDescription(rawShortDescription) {
        if (!isEmpty(rawShortDescription) && !isEmpty(rawShortDescription.localizedContent)) {
            const shortDescription = {};
            shortDescription.localizedContent = this.createLocalizedContents(rawShortDescription.localizedContent);
            return shortDescription;
        }
        return {};
    }
    createBrand(rawBrand) {
        if (!isEmpty(rawBrand) && !isEmpty(rawBrand.localizedContent)) {
            const brand = {};
            brand.localizedContent = this.createLocalizedContents(rawBrand.localizedContent);
            return brand;
        }
        return {};
    }
    static ɵfac = function OmapiQueryProductMapper_Factory(t) { return new (t || OmapiQueryProductMapper)(); };
    static ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: OmapiQueryProductMapper, factory: OmapiQueryProductMapper.ɵfac, providedIn: 'root' });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(OmapiQueryProductMapper, [{
        type: Injectable,
        args: [{
                providedIn: 'root',
            }]
    }], null, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib21hcGktcXVlcnktcHJvZHVjdC5tYXBwZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL21hcHBlcnMvb21hcGktcXVlcnktcHJvZHVjdC5tYXBwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFdBQVcsQ0FBQzs7QUEwQjNDLE1BQU0sT0FBTyx1QkFBdUI7SUFHbEMsT0FBTyxDQUFDLG9CQUFtRDtRQUN6RCxPQUFPLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFFTyx1QkFBdUIsQ0FBQyxvQkFBbUQ7UUFDakYsTUFBTSxpQkFBaUIsR0FBRyxFQUFnQyxDQUFDO1FBQzNELGlCQUFpQixDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFckYsT0FBTyxpQkFBaUIsQ0FBQztJQUMzQixDQUFDO0lBRUQsbUJBQW1CLENBQUMsZ0JBQXFEO1FBQ3ZFLE9BQU8sQ0FDTCxnQkFBZ0I7WUFDaEIsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUMsZUFBZSxFQUFFLEVBQUU7Z0JBQ3ZDLE9BQU8sSUFBSSxDQUFDLHNCQUFzQixDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQ3RELENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBRUQsc0JBQXNCLENBQUMsZUFBa0Q7UUFDdkUsTUFBTSxZQUFZLEdBQUcsRUFBNEIsQ0FBQztRQUNsRCxZQUFZLENBQUMsUUFBUSxHQUFHLGVBQWUsQ0FBQyxRQUFRLENBQUM7UUFDakQsWUFBWSxDQUFDLGFBQWEsR0FBRyxlQUFlLENBQUMsYUFBYSxDQUFDO1FBQzNELFlBQVksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWMs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QW9CLENBQUM7SUFDOUIsQ0FBQztpRkE1SFUsdUJBQXVCO2dFQUF2Qix1QkFBdUIsV0FBdkIsdUJBQXVCLG1CQUZ0QixNQUFNOztpRkFFUCx1QkFBdUI7Y0FIbkMsVUFBVTtlQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNFbXB0eSwgaXNOaWwgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHtcbiAgQnJhbmRJbnRlcmZhY2UsXG4gIEltYWdlc0ludGVyZmFjZSxcbiAgTG9jYWxpemVkQ29udGVudEludGVyZmFjZSxcbiAgT21hcGlRdWVyeVByb2R1Y3RJbnRlcmZhY2UsXG4gIFByaWNlc0ludGVyZmFjZSxcbiAgUXVlcnlQcm9kdWN0c0ludGVyZmFjZSxcbiAgU2hvcnREZXNjcmlwdGlvbkludGVyZmFjZSxcbiAgVmFyaWFudHNJbnRlcmZhY2UsXG59IGZyb20gJy4uL2ludGVyZmFjZXMvb21hcGktcXVlcnktcHJvZHVjdC5pbnRlcmZhY2UnO1xuaW1wb3J0IHtcbiAgUmF3QnJhbmRJbnRlcmZhY2UsXG4gIFJhd0ltYWdlc0ludGVyZmFjZSxcbiAgUmF3TG9jYWxpemVkQ29udGVudEludGVyZmFjZSxcbiAgUmF3T21hcGlRdWVyeVByb2R1Y3RJbnRlcmZhY2UsXG4gIFJhd09tYXBpUXVlcnlQcm9kdWN0SW50ZXJmYWNlRGF0YSxcbiAgUmF3UHJpY2VzSW50ZXJmYWNlLFxuICBSYXdTaG9ydERlc2NyaXB0aW9uLFxuICBSYXdWYXJpYW50c0ludGVyZmFjZSxcbn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9yYXctb21hcGktcXVlcnktcHJvZHVjdC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgTWFwcGVySW50ZXJmYWNlIH0gZnJvbSAnQHRlbGVuZXQvbmctbGliLXNoYXJlZCc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBPbWFwaVF1ZXJ5UHJvZHVjdE1hcHBlclxuICBpbXBsZW1lbnRzIE1hcHBlckludGVyZmFjZTxSYXdPbWFwaVF1ZXJ5UHJvZHVjdEludGVyZmFjZSwgT21hcGlRdWVyeVByb2R1Y3RJbnRlcmZhY2U+XG57XG4gIHRvTW9kZWwocmF3T21hcGlRdWVyeVByb2R1Y3Q6IFJhd09tYXBpUXVlcnlQcm9kdWN0SW50ZXJmYWNlKTogT21hcGlRdWVyeVByb2R1Y3RJbnRlcmZhY2Uge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZU9tYXBpUXVlcnlQcm9kdWN0KHJhd09tYXBpUXVlcnlQcm9kdWN0KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlT21hcGlRdWVyeVByb2R1Y3QocmF3T21hcGlRdWVyeVByb2R1Y3Q6IFJhd09tYXBpUXVlcnlQcm9kdWN0SW50ZXJmYWNlKTogT21hcGlRdWVyeVByb2R1Y3RJbnRlcmZhY2Uge1xuICAgIGNvbnN0IG9tYXBpUXVlcnlQcm9kdWN0ID0ge30gYXMgT21hcGlRdWVyeVByb2R1Y3RJbnRlcmZhY2U7XG4gICAgb21hcGlRdWVyeVByb2R1Y3QucHJvZHVjdHMgPSB0aGlzLmNyZWF0ZVF1ZXJ5UHJvZHVjdHMocmF3T21hcGlRdWVyeVByb2R1Y3QucHJvZHVjdHMpO1xuXG4gICAgcmV0dXJuIG9tYXBpUXVlcnlQcm9kdWN0O1xuICB9XG5cbiAgY3JlYXRlUXVlcnlQcm9kdWN0cyhyYXdRdWVyeVByb2R1Y3RzOiBSYXdPbWFwaVF1ZXJ5UHJvZHVjdEludGVyZmFjZURhdGFbXSk6IFF1ZXJ5UHJvZHVjdHNJbnRlcmZhY2VbXSB7XG4gICAgcmV0dXJuIChcbiAgICAgIHJhd1F1ZXJ5UHJvZHVjdHMgJiZcbiAgICAgIHJhd1F1ZXJ5UHJvZHVjdHMubWFwKChyYXdRdWVyeVByb2R1Y3QpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlUXVlcnlQcm9kdWN0RGF0YShyYXdRdWVyeVByb2R1Y3QpO1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgY3JlYXRlUXVlcnlQcm9kdWN0RGF0YShyYXdRdWVyeVByb2R1Y3Q6IFJhd09tYXBpUXVlcnlQcm9kdWN0SW50ZXJmYWNlRGF0YSk6IFF1ZXJ5UHJvZHVjdHNJbnRlcmZhY2Uge1xuICAgIGNvbnN0IHF1ZXJ5UHJvZHVjdCA9IHt9IGFzIFF1ZXJ5UHJvZHVjdHNJbnRlcmZhY2U7XG4gICAgcXVlcnlQcm9kdWN0LmxhYmVsS2V5ID0gcmF3UXVlcnlQcm9kdWN0LmxhYmVsS2V5O1xuICAgIHF1ZXJ5UHJvZHVjdC5wcm9kdWN0RmFtaWx5ID0gcmF3UXVlcnlQcm9kdWN0LnByb2R1Y3RGYW1pbHk7XG4gICAgcXVlcnlQcm9kdWN0LnZhcmlhbnRzID0gdGhpcy5jcmVhdGVWYXJpYW50cyhyYXdRdWVyeVByb2R1Y3QudmFyaWFudHMpO1xuICAgIHJldHVybiBxdWVyeVByb2R1Y3Q7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUxvY2FsaXplZENvbnRlbnRzKHJhd0xvY2FsaXplZENvbnRlbnRzOiBSYXdMb2NhbGl6ZWRDb250ZW50SW50ZXJmYWNlW10pOiBMb2NhbGl6ZWRDb250ZW50SW50ZXJmYWNlW10ge1xuICAgIHJldHVybiAoXG4gICAgICByYXdMb2NhbGl6ZWRDb250ZW50cyAmJlxuICAgICAgcmF3TG9jYWxpemVkQ29udGVudHMubWFwKChyYXdMb2NhbGl6ZWRDb250ZW50KSA9PiB7XG4gICAgICAgIHJldHVybiBPbWFwaVF1ZXJ5UHJvZHVjdE1hcHBlci5jcmVhdGVMb2NhbGl6ZWRDb250ZW50KHJhd0xvY2FsaXplZENvbnRlbnQpO1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgY3JlYXRlTG9jYWxpemVkQ29udGVudChyYXdMb2NhbGl6ZWRDb250ZW50OiBSYXdMb2NhbGl6ZWRDb250ZW50SW50ZXJmYWNlKTogTG9jYWxpemVkQ29udGVudEludGVyZmFjZSB7XG4gICAgY29uc3QgbG9jYWxpemVkQ29udGVudCA9IHt9IGFzIExvY2FsaXplZENvbnRlbnRJbnRlcmZhY2U7XG4gICAgbG9jYWxpemVkQ29udGVudC5sb2NhbGUgPSByYXdMb2NhbGl6ZWRDb250ZW50LmxvY2FsZTtcbiAgICBsb2NhbGl6ZWRDb250ZW50LmtleSA9IHJhd0xvY2FsaXplZENvbnRlbnQua2V5O1xuICAgIGxvY2FsaXplZENvbnRlbnQuZGF0YSA9IHJhd0xvY2FsaXplZENvbnRlbnQuZGF0YTtcbiAgICBsb2NhbGl6ZWRDb250ZW50LnZhbHVlID0gT21hcGlRdWVyeVByb2R1Y3RNYXBwZXIuY3JlYXRlTG9jYWxpemVkQ29udGVudFZhbHVlKFxuICAgICAgcmF3TG9jYWxpemVkQ29udGVudC52YWx1ZSA/IHJhd0xvY2FsaXplZENvbnRlbnQudmFsdWUgOiBbXVxuICAgICk7XG4gICAgcmV0dXJuIGxvY2FsaXplZENvbnRlbnQ7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBjcmVhdGVMb2NhbGl6ZWRDb250ZW50VmFsdWUocmF3TG9jYWxpemVkQ29udGVudFZhbHVlOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gKFxuICAgICAgcmF3TG9jYWxpemVkQ29udGVudFZhbHVlICYmXG4gICAgICByYXdMb2NhbGl6ZWRDb250ZW50VmFsdWUubWFwKCh2YWx1ZSkgPT4ge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVZhcmlhbnRzKHJhd1ZhcmlhbnRzOiBSYXdWYXJpYW50c0ludGVyZmFjZVtdKTogVmFyaWFudHNJbnRlcmZhY2VbXSB7XG4gICAgcmV0dXJuIChcbiAgICAgIHJhd1ZhcmlhbnRzICYmXG4gICAgICByYXdWYXJpYW50cy5tYXAoKHJhd1ZhcmlhbnQpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVmFyaWFudChyYXdWYXJpYW50KTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVmFyaWFudChyYXdWYXJpYW50OiBSYXdWYXJpYW50c0ludGVyZmFjZSk6IFZhcmlhbnRzSW50ZXJmYWNlIHtcbiAgICBjb25zdCB2YXJpYW50ID0ge30gYXMgVmFyaWFudHNJbnRlcmZhY2U7XG4gICAgdmFyaWFudC5wcm9kdWN0SWQgPSByYXdWYXJpYW50LnByb2R1Y3RJZDtcbiAgICBpZiAoIWlzTmlsKHJhd1ZhcmlhbnQuZXh0cmFBdEhvbWVEZWxpdmVyeSkpIHtcbiAgICAgIHZhcmlhbnQuZXh0cmFBdEhvbWVEZWxpdmVyeSA9IHJhd1ZhcmlhbnQuZXh0cmFBdEhvbWVEZWxpdmVyeTtcbiAgICB9XG4gICAgdmFyaWFudC5wcmljZXMgPSBPbWFwaVF1ZXJ5UHJvZHVjdE1hcHBlci5jcmVhdGVQcmljZXMocmF3VmFyaWFudC5wcmljZXMpO1xuICAgIHZhcmlhbnQuaW1hZ2VzID0gdGhpcy5jcmVhdGVJbWFnZXMocmF3VmFyaWFudC5pbWFnZXMpO1xuICAgIGNvbnN0IHNob3J0RGVzY3JpcHRpb24gPSB0aGlzLmNyZWF0ZVNob3J0RGVzY3JpcHRpb24ocmF3VmFyaWFudC5zaG9ydERlc2NyaXB0aW9uKTtcbiAgICBpZiAoc2hvcnREZXNjcmlwdGlvbikge1xuICAgICAgdmFyaWFudC5zaG9ydERlc2NyaXB0aW9uID0gc2hvcnREZXNjcmlwdGlvbjtcbiAgICB9XG4gICAgdmFyaWFudC5icmFuZCA9IHRoaXMuY3JlYXRlQnJhbmQocmF3VmFyaWFudC5tYW5CcmFuZCk7XG4gICAgcmV0dXJuIHZhcmlhbnQ7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBjcmVhdGVQcmljZXMocmF3UHJpY2VzOiBSYXdQcmljZXNJbnRlcmZhY2UpOiBQcmljZXNJbnRlcmZhY2Uge1xuICAgIGNvbnN0IHByaWNlcyA9IHt9IGFzIFByaWNlc0ludGVyZmFjZTtcbiAgICBwcmljZXMucHJpY2VUeXBlID0gcmF3UHJpY2VzLnByaWNlVHlwZTtcbiAgICByZXR1cm4gcHJpY2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVJbWFnZXMocmF3SW1hZ2VzOiBSYXdJbWFnZXNJbnRlcmZhY2VbXSk6IEltYWdlc0ludGVyZmFjZVtdIHtcbiAgICByZXR1cm4gKFxuICAgICAgcmF3SW1hZ2VzICYmXG4gICAgICByYXdJbWFnZXMubWFwKChyYXdJbWFnZSkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVJbWFnZShyYXdJbWFnZSk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUltYWdlKHJhd0ltYWdlOiBSYXdJbWFnZXNJbnRlcmZhY2UpOiBJbWFnZXNJbnRlcmZhY2Uge1xuICAgIGNvbnN0IGltYWdlID0ge30gYXMgSW1hZ2VzSW50ZXJmYWNlO1xuICAgIGltYWdlLmF0dHJpYnV0ZUtleSA9IHJhd0ltYWdlLmF0dHJpYnV0ZUtleTtcbiAgICBpbWFnZS52YWx1ZSA9IHJhd0ltYWdlLnZhbHVlO1xuICAgIGltYWdlLmxvY2FsaXplZENvbnRlbnQgPSB0aGlzLmNyZWF0ZUxvY2FsaXplZENvbnRlbnRzKHJhd0ltYWdlLmxvY2FsaXplZENvbnRlbnQpO1xuICAgIHJldHVybiBpbWFnZTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlU2hvcnREZXNjcmlwdGlvbihyYXdTaG9ydERlc2NyaXB0aW9uOiBSYXdTaG9ydERlc2NyaXB0aW9uKTogU2hvcnREZXNjcmlwdGlvbkludGVyZmFjZSB7XG4gICAgaWYgKCFpc0VtcHR5KHJhd1Nob3J0RGVzY3JpcHRpb24pICYmICFpc0VtcHR5KHJhd1Nob3J0RGVzY3JpcHRpb24ubG9jYWxpemVkQ29udGVudCkpIHtcbiAgICAgIGNvbnN0IHNob3J0RGVzY3JpcHRpb24gPSB7fSBhcyBTaG9ydERlc2NyaXB0aW9uSW50ZXJmYWNlO1xuICAgICAgc2hvcnREZXNjcmlwdGlvbi5sb2NhbGl6ZWRDb250ZW50ID0gdGhpcy5jcmVhdGVMb2NhbGl6ZWRDb250ZW50cyhyYXdTaG9ydERlc2NyaXB0aW9uLmxvY2FsaXplZENvbnRlbnQpO1xuICAgICAgcmV0dXJuIHNob3J0RGVzY3JpcHRpb247XG4gICAgfVxuXG4gICAgcmV0dXJuIHt9IGFzIFNob3J0RGVzY3JpcHRpb25JbnRlcmZhY2U7XG4gIH1cbiAgcHJpdmF0ZSBjcmVhdGVCcmFuZChyYXdCcmFuZDogUmF3QnJhbmRJbnRlcmZhY2UpOiBCcmFuZEludGVyZmFjZSB7XG4gICAgaWYgKCFpc0VtcHR5KHJhd0JyYW5kKSAmJiAhaXNFbXB0eShyYXdCcmFuZC5sb2NhbGl6ZWRDb250ZW50KSkge1xuICAgICAgY29uc3QgYnJhbmQgPSB7fSBhcyBCcmFuZEludGVyZmFjZTtcbiAgICAgIGJyYW5kLmxvY2FsaXplZENvbnRlbnQgPSB0aGlzLmNyZWF0ZUxvY2FsaXplZENvbnRlbnRzKHJhd0JyYW5kLmxvY2FsaXplZENvbnRlbnQpO1xuICAgICAgcmV0dXJuIGJyYW5kO1xuICAgIH1cbiAgICByZXR1cm4ge30gYXMgQnJhbmRJbnRlcmZhY2U7XG4gIH1cbn1cbiJdfQ==