import { forEach } from 'lodash-es';
import { AppointmentTransformerModel, AppointmentTransformerSlot, NCTimeSlot, } from '../models';
import { AppointmentPickerConsumerTypeEnum, } from '../interfaces';
import { TimeslotUtil } from './timeslot.util';
export class AppointmentTransformerUtil {
    static doTransform(timeSlots, consumerType) {
        switch (consumerType) {
            case AppointmentPickerConsumerTypeEnum.CAFE:
                return this.doCafeTransform(timeSlots);
            case AppointmentPickerConsumerTypeEnum.NC:
                return this.doNCTransform(timeSlots);
        }
    }
    static doCafeTransform(cafeTimeSlots) {
        const appointmentTransformerModel = new AppointmentTransformerModel();
        appointmentTransformerModel.slots = [];
        forEach(cafeTimeSlots, (cafeTimeSlot) => {
            if (cafeTimeSlot) {
                appointmentTransformerModel.slots.push(this.getCafeTransformedAvailability(cafeTimeSlot));
            }
        });
        return appointmentTransformerModel;
    }
    static getCafeTransformedAvailability(timeSlot) {
        const appointmentTransformedSlot = new AppointmentTransformerSlot();
        appointmentTransformedSlot.timeSlots = [];
        const cafeTimeSlot = timeSlot;
        const isCustomMoment = cafeTimeSlot.isCustomMoment;
        if (cafeTimeSlot.date) {
            appointmentTransformedSlot.date = cafeTimeSlot.date;
        }
        if (cafeTimeSlot.moments) {
            forEach(cafeTimeSlot.moments, (availability) => {
                appointmentTransformedSlot.timeSlots.push(this.getCafeAvailability(false, availability));
            });
        }
        if (isCustomMoment && cafeTimeSlot.momentObjects) {
            appointmentTransformedSlot.isCustomMoment = true;
            appointmentTransformedSlot.timeSlots = cafeTimeSlot.momentObjects.map((timeslotMoment) => this.getCafeAvailability(true, timeslotMoment.key, timeslotMoment));
        }
        return appointmentTransformedSlot;
    }
    static getCafeAvailability(isCustomMoment, timeslotKey, timeslotMoment) {
        const timeslotMomentObj = isCustomMoment ? timeslotMoment : TimeslotUtil.enumToMomentObject(timeslotKey);
        return { code: timeslotKey, timeslotMoment: timeslotMomentObj };
    }
    static doNCTransform(timeSlots) {
        const transformerModel = new AppointmentTransformerModel();
        transformerModel.slots = [];
        forEach(timeSlots, (timeSlot) => {
            if (timeSlot && timeSlot instanceof NCTimeSlot) {
                transformerModel.slots.push(this.getNCTransformedAvailability(timeSlot));
            }
        });
        return transformerModel;
    }
    static getNCTransformedAvailability(timeSlot) {
        const appointmentTransformedSlot = new AppointmentTransformerSlot();
        appointmentTransformedSlot.timeSlots = [];
        if (timeSlot.date) {
            appointmentTransformedSlot.date = timeSlot.date;
        }
        if (timeSlot instanceof NCTimeSlot && timeSlot.timeSlots) {
            forEach(timeSlot.timeSlots, (nCTimeSlotAvailability) => {
                appointmentTransformedSlot.timeSlots.push(this.getNCAvailability(nCTimeSlotAvailability));
            });
        }
        return appointmentTransformedSlot;
    }
    static getNCAvailability(nCTimeSlotAvailability) {
        const transformedAvailability = {};
        transformedAvailability.specUrl = nCTimeSlotAvailability.specUrl;
        transformedAvailability.code = nCTimeSlotAvailability.code;
        transformedAvailability.availabiltyId = nCTimeSlotAvailability.availabilityId;
        transformedAvailability.timeFormat = nCTimeSlotAvailability.timeFormat;
        transformedAvailability.productInfo = nCTimeSlotAvailability.productInfo;
        return transformedAvailability;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwb2ludG1lbnQtdHJhbnNmb3JtZXIudXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9hcHBvaW50bWVudC10cmFuc2Zvcm1lci51dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDcEMsT0FBTyxFQUNMLDJCQUEyQixFQUMzQiwwQkFBMEIsRUFFMUIsVUFBVSxHQUVYLE1BQU0sV0FBVyxDQUFDO0FBRW5CLE9BQU8sRUFDTCxpQ0FBaUMsR0FJbEMsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRS9DLE1BQU0sT0FBTywwQkFBMEI7SUFDckMsTUFBTSxDQUFDLFdBQVcsQ0FDaEIsU0FBOEIsRUFDOUIsWUFBK0M7UUFFL0MsUUFBUSxZQUFZLEVBQUUsQ0FBQztZQUNyQixLQUFLLGlDQUFpQyxDQUFDLElBQUk7Z0JBQ3pDLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN6QyxLQUFLLGlDQUFpQyxDQUFDLEVBQUU7Z0JBQ3ZDLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN6QyxDQUFDO0lBQ0gsQ0FBQztJQUVPLE1BQU0sQ0FBQyxlQUFlLENBQUMsYUFBa0M7UUFDL0QsTUFBTSwyQkFBMkIsR0FBRyxJQUFJLDJCQUEyQixFQUFFLENBQUM7UUFDdEUsMkJBQTJCLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUN2QyxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUMsWUFBK0IsRUFBRSxFQUFFO1lBQ3pELElBQUksWUFBWSxFQUFFLENBQUM7Z0JBQ2pCLDJCQUEyQixDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLDhCQUE4QixDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDNUYsQ0FBQztRQUNI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QyxzQkFBc0IsQ0FBQyxDQUFDLENBQUM7WUFDNUYsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsT0FBTywwQkFBMEIsQ0FBQztJQUNwQyxDQUFDO0lBRU8sTUFBTSxDQUFDLGlCQUFpQixDQUFDLHNCQUE4QztRQUM3RSxNQUFNLHVCQUF1QixHQUFHLEVBQXNDLENBQUM7UUFDdkUsdUJBQXVCLENBQUMsT0FBTyxHQUFHLHNCQUFzQixDQUFDLE9BQU8sQ0FBQztRQUNqRSx1QkFBdUIsQ0FBQyxJQUFJLEdBQUcsc0JBQXNCLENBQUMsSUFBSSxDQUFDO1FBQzNELHVCQUF1QixDQUFDLGFBQWEsR0FBRyxzQkFBc0IsQ0FBQyxjQUFjLENBQUM7UUFDOUUsdUJBQXVCLENBQUMsVUFBVSxHQUFHLHNCQUFzQixDQUFDLFVBQVUsQ0FBQztRQUN2RSx1QkFBdUIsQ0FBQyxXQUFXLEdBQUcsc0JBQXNCLENBQUMsV0FBVyxDQUFDO1FBQ3pFLE9BQU8sdUJBQXVCLENBQUM7SUFDakMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZm9yRWFjaCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQge1xuICBBcHBvaW50bWVudFRyYW5zZm9ybWVyTW9kZWwsXG4gIEFwcG9pbnRtZW50VHJhbnNmb3JtZXJTbG90LFxuICBDYWZlVGltZVNsb3QsXG4gIE5DVGltZVNsb3QsXG4gIE5DVGltZVNsb3RBdmFpbGFiaWxpdHksXG59IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBUaW1lc2xvdE1vbWVudEVudW0gfSBmcm9tICcuLi9lbnVtcyc7XG5pbXBvcnQge1xuICBBcHBvaW50bWVudFBpY2tlckNvbnN1bWVyVHlwZUVudW0sXG4gIFRpbWVTbG90SW50ZXJmYWNlLFxuICBUaW1lc2xvdE1vbWVudEludGVyZmFjZSxcbiAgVHJhbnNmb3JtZWRBdmFpbGFiaWxpdHlJbnRlcmZhY2UsXG59IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgVGltZXNsb3RVdGlsIH0gZnJvbSAnLi90aW1lc2xvdC51dGlsJztcblxuZXhwb3J0IGNsYXNzIEFwcG9pbnRtZW50VHJhbnNmb3JtZXJVdGlsIHtcbiAgc3RhdGljIGRvVHJhbnNmb3JtKFxuICAgIHRpbWVTbG90czogVGltZVNsb3RJbnRlcmZhY2VbXSxcbiAgICBjb25zdW1lclR5cGU6IEFwcG9pbnRtZW50UGlja2VyQ29uc3VtZXJUeXBlRW51bVxuICApOiBBcHBvaW50bWVudFRyYW5zZm9ybWVyTW9kZWwge1xuICAgIHN3aXRjaCAoY29uc3VtZXJUeXBlKSB7XG4gICAgICBjYXNlIEFwcG9pbnRtZW50UGlja2VyQ29uc3VtZXJUeXBlRW51bS5DQUZFOlxuICAgICAgICByZXR1cm4gdGhpcy5kb0NhZmVUcmFuc2Zvcm0odGltZVNsb3RzKTtcbiAgICAgIGNhc2UgQXBwb2ludG1lbnRQaWNrZXJDb25zdW1lclR5cGVFbnVtLk5DOlxuICAgICAgICByZXR1cm4gdGhpcy5kb05DVHJhbnNmb3JtKHRpbWVTbG90cyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZG9DYWZlVHJhbnNmb3JtKGNhZmVUaW1lU2xvdHM6IFRpbWVTbG90SW50ZXJmYWNlW10pOiBBcHBvaW50bWVudFRyYW5zZm9ybWVyTW9kZWwge1xuICAgIGNvbnN0IGFwcG9pbnRtZW50VHJhbnNmb3JtZXJNb2RlbCA9IG5ldyBBcHBvaW50bWVudFRyYW5zZm9ybWVyTW9kZWwoKTtcbiAgICBhcHBvaW50bWVudFRyYW5zZm9ybWVyTW9kZWwuc2xvdHMgPSBbXTtcbiAgICBmb3JFYWNoKGNhZmVUaW1lU2xvdHMsIChjYWZlVGltZVNsb3Q6IFRpbWVTbG90SW50ZXJmYWNlKSA9PiB7XG4gICAgICBpZiAoY2FmZVRpbWVTbG90KSB7XG4gICAgICAgIGFwcG9pbnRtZW50VHJhbnNmb3JtZXJNb2RlbC5zbG90cy5wdXNoKHRoaXMuZ2V0Q2FmZVRyYW5zZm9ybWVkQXZhaWxhYmlsaXR5KGNhZmVUaW1lU2xvdCkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBhcHBvaW50bWVudFRyYW5zZm9ybWVyTW9kZWw7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBnZXRDYWZlVHJhbnNmb3JtZWRBdmFpbGFiaWxpdHkodGltZVNsb3Q6IFRpbWVTbG90SW50ZXJmYWNlKTogQXBwb2ludG1lbnRUcmFuc2Zvcm1lclNsb3Qge1xuICAgIGNvbnN0IGFwcG9pbnRtZW50VHJhbnNmb3JtZWRTbG90ID0gbmV3IEFwcG9pbnRtZW50VHJhbnNmb3JtZXJTbG90KCk7XG4gICAgYXBwb2ludG1lbnRUcmFuc2Zvcm1lZFNsb3QudGltZVNsb3RzID0gW107XG4gICAgY29uc3QgY2FmZVRpbWVTbG90OiBDYWZlVGltZVNsb3QgPSB0aW1lU2xvdCBhcyBDYWZlVGltZVNsb3Q7XG4gICAgY29uc3QgaXNDdXN0b21Nb21lbnQgPSBjYWZlVGltZVNsb3QuaXNDdXN0b21Nb21lbnQ7XG5cbiAgICBpZiAoY2FmZVRpbWVTbG90LmRhdGUpIHtcbiAgICAgIGFwcG9pbnRtZW50VHJhbnNmb3JtZWRTbG90LmRhdGUgPSBjYWZlVGltZVNsb3QuZGF0ZTtcbiAgICB9XG5cbiAgICBpZiAoY2FmZVRpbWVTbG90Lm1vbWVudHMpIHtcbiAgICAgIGZvckVhY2goY2FmZVRpbWVTbG90Lm1vbWVudHMsIChhdmFpbGFiaWxpdHk6IFRpbWVzbG90TW9tZW50RW51bSkgPT4ge1xuICAgICAgICBhcHBvaW50bWVudFRyYW5zZm9ybWVkU2xvdC50aW1lU2xvdHMucHVzaCh0aGlzLmdldENhZmVBdmFpbGFiaWxpdHkoZmFsc2UsIGF2YWlsYWJpbGl0eSkpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGlzQ3VzdG9tTW9tZW50ICYmIGNhZmVUaW1lU2xvdC5tb21lbnRPYmplY3RzKSB7XG4gICAgICBhcHBvaW50bWVudFRyYW5zZm9ybWVkU2xvdC5pc0N1c3RvbU1vbWVudCA9IHRydWU7XG4gICAgICBhcHBvaW50bWVudFRyYW5zZm9ybWVkU2xvdC50aW1lU2xvdHMgPSBjYWZlVGltZVNsb3QubW9tZW50T2JqZWN0cy5tYXAoKHRpbWVzbG90TW9tZW50OiBUaW1lc2xvdE1vbWVudEludGVyZmFjZSkgPT5cbiAgICAgICAgdGhpcy5nZXRDYWZlQXZhaWxhYmlsaXR5KHRydWUsIHRpbWVzbG90TW9tZW50LmtleSwgdGltZXNsb3RNb21lbnQpXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBhcHBvaW50bWVudFRyYW5zZm9ybWVkU2xvdDtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGdldENhZmVBdmFpbGFiaWxpdHkoXG4gICAgaXNDdXN0b21Nb21lbnQ6IGJvb2xlYW4sXG4gICAgdGltZXNsb3RLZXk6IFRpbWVzbG90TW9tZW50RW51bSxcbiAgICB0aW1lc2xvdE1vbWVudD86IFRpbWVzbG90TW9tZW50SW50ZXJmYWNlXG4gICk6IFRyYW5zZm9ybWVkQXZhaWxhYmlsaXR5SW50ZXJmYWNlIHtcbiAgICBjb25zdCB0aW1lc2xvdE1vbWVudE9iaiA9IGlzQ3VzdG9tTW9tZW50ID8gdGltZXNsb3RNb21lbnQgOiBUaW1lc2xvdFV0aWwuZW51bVRvTW9tZW50T2JqZWN0KHRpbWVzbG90S2V5KTtcbiAgICByZXR1cm4geyBjb2RlOiB0aW1lc2xvdEtleSwgdGltZXNsb3RNb21lbnQ6IHRpbWVzbG90TW9tZW50T2JqIH0gYXMgVHJhbnNmb3JtZWRBdmFpbGFiaWxpdHlJbnRlcmZhY2U7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBkb05DVHJhbnNmb3JtKHRpbWVTbG90czogVGltZVNsb3RJbnRlcmZhY2VbXSk6IEFwcG9pbnRtZW50VHJhbnNmb3JtZXJNb2RlbCB7XG4gICAgY29uc3QgdHJhbnNmb3JtZXJNb2RlbCA9IG5ldyBBcHBvaW50bWVudFRyYW5zZm9ybWVyTW9kZWwoKTtcbiAgICB0cmFuc2Zvcm1lck1vZGVsLnNsb3RzID0gW107XG4gICAgZm9yRWFjaCh0aW1lU2xvdHMsICh0aW1lU2xvdDogVGltZVNsb3RJbnRlcmZhY2UpID0+IHtcbiAgICAgIGlmICh0aW1lU2xvdCAmJiB0aW1lU2xvdCBpbnN0YW5jZW9mIE5DVGltZVNsb3QpIHtcbiAgICAgICAgdHJhbnNmb3JtZXJNb2RlbC5zbG90cy5wdXNoKHRoaXMuZ2V0TkNUcmFuc2Zvcm1lZEF2YWlsYWJpbGl0eSh0aW1lU2xvdCkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiB0cmFuc2Zvcm1lck1vZGVsO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0TkNUcmFuc2Zvcm1lZEF2YWlsYWJpbGl0eSh0aW1lU2xvdDogVGltZVNsb3RJbnRlcmZhY2UpOiBBcHBvaW50bWVudFRyYW5zZm9ybWVyU2xvdCB7XG4gICAgY29uc3QgYXBwb2ludG1lbnRUcmFuc2Zvcm1lZFNsb3QgPSBuZXcgQXBwb2ludG1lbnRUcmFuc2Zvcm1lclNsb3QoKTtcbiAgICBhcHBvaW50bWVudFRyYW5zZm9ybWVkU2xvdC50aW1lU2xvdHMgPSBbXTtcbiAgICBpZiAodGltZVNsb3QuZGF0ZSkge1xuICAgICAgYXBwb2ludG1lbnRUcmFuc2Zvcm1lZFNsb3QuZGF0ZSA9IHRpbWVTbG90LmRhdGU7XG4gICAgfVxuXG4gICAgaWYgKHRpbWVTbG90IGluc3RhbmNlb2YgTkNUaW1lU2xvdCAmJiB0aW1lU2xvdC50aW1lU2xvdHMpIHtcbiAgICAgIGZvckVhY2godGltZVNsb3QudGltZVNsb3RzLCAobkNUaW1lU2xvdEF2YWlsYWJpbGl0eTogTkNUaW1lU2xvdEF2YWlsYWJpbGl0eSkgPT4ge1xuICAgICAgICBhcHBvaW50bWVudFRyYW5zZm9ybWVkU2xvdC50aW1lU2xvdHMucHVzaCh0aGlzLmdldE5DQXZhaWxhYmlsaXR5KG5DVGltZVNsb3RBdmFpbGFiaWxpdHkpKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBhcHBvaW50bWVudFRyYW5zZm9ybWVkU2xvdDtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGdldE5DQXZhaWxhYmlsaXR5KG5DVGltZVNsb3RBdmFpbGFiaWxpdHk6IE5DVGltZVNsb3RBdmFpbGFiaWxpdHkpOiBUcmFuc2Zvcm1lZEF2YWlsYWJpbGl0eUludGVyZmFjZSB7XG4gICAgY29uc3QgdHJhbnNmb3JtZWRBdmFpbGFiaWxpdHkgPSB7fSBhcyBUcmFuc2Zvcm1lZEF2YWlsYWJpbGl0eUludGVyZmFjZTtcbiAgICB0cmFuc2Zvcm1lZEF2YWlsYWJpbGl0eS5zcGVjVXJsID0gbkNUaW1lU2xvdEF2YWlsYWJpbGl0eS5zcGVjVXJsO1xuICAgIHRyYW5zZm9ybWVkQXZhaWxhYmlsaXR5LmNvZGUgPSBuQ1RpbWVTbG90QXZhaWxhYmlsaXR5LmNvZGU7XG4gICAgdHJhbnNmb3JtZWRBdmFpbGFiaWxpdHkuYXZhaWxhYmlsdHlJZCA9IG5DVGltZVNsb3RBdmFpbGFiaWxpdHkuYXZhaWxhYmlsaXR5SWQ7XG4gICAgdHJhbnNmb3JtZWRBdmFpbGFiaWxpdHkudGltZUZvcm1hdCA9IG5DVGltZVNsb3RBdmFpbGFiaWxpdHkudGltZUZvcm1hdDtcbiAgICB0cmFuc2Zvcm1lZEF2YWlsYWJpbGl0eS5wcm9kdWN0SW5mbyA9IG5DVGltZVNsb3RBdmFpbGFiaWxpdHkucHJvZHVjdEluZm87XG4gICAgcmV0dXJuIHRyYW5zZm9ybWVkQXZhaWxhYmlsaXR5O1xuICB9XG59XG4iXX0=