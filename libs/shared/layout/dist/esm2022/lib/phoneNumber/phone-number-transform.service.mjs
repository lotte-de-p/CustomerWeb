import { Injectable } from '@angular/core';
import { RegexConstants } from '../constants/regex.constant';
import * as i0 from "@angular/core";
import * as i1 from "../services/constraints/constraints.service";
export class PhoneNumberTransformService {
    constraintsService;
    constructor(constraintsService) {
        this.constraintsService = constraintsService;
    }
    transform(phoneNumber) {
        if (RegexConstants.NATIONAL_PHONE_NUMBER.test(phoneNumber)) {
            return this.filterNationalPhoneNumber(phoneNumber);
        }
        if (RegexConstants.NATIONAL_MOBILE_NUMBER.test(phoneNumber)) {
            return this.filterNationalMobileNumber(phoneNumber);
        }
        if (RegexConstants.BASE_PHONE_NUMBER.test(phoneNumber)) {
            return this.filterBasePhoneNumber(phoneNumber);
        }
        if (RegexConstants.INTERNATIONAL_PHONE_NUMBER.test(phoneNumber)) {
            return this.filterInternationalNumber(phoneNumber);
        }
        return phoneNumber;
    }
    doNormaliseMsisdn(phoneNumber) {
        let transFormedNumber = this.transform(phoneNumber);
        transFormedNumber = transFormedNumber.indexOf('0') !== 0 ? '0' + transFormedNumber : transFormedNumber;
        return transFormedNumber && transFormedNumber.replace(/ /g, '');
    }
    autoFormatPhoneNumber(msisdn) {
        const formattedPhoneNumber = this.doNormaliseMsisdn(msisdn);
        if (!msisdn || !formattedPhoneNumber) {
            return msisdn;
        }
        else {
            if (this.constraintsService.isValidNationalMobileNumber(formattedPhoneNumber)) {
                return 0 + formattedPhoneNumber.substring(1);
            }
            else if (this.constraintsService.isValidInternationalNumber(msisdn)) {
                return msisdn;
            }
            return formattedPhoneNumber;
        }
    }
    filterNationalPhoneNumber(phoneNumber) {
        const numberLength = phoneNumber.length;
        let numberStart = phoneNumber.slice(0, numberLength - 6);
        let zoneCode = '0';
        if (this.contains(numberStart, '0032')) {
            numberStart = numberStart.slice(4, numberStart.length);
        }
        if (this.contains(numberStart, '+32')) {
            numberStart = numberStart.slice(3, numberStart.length);
        }
        if (numberStart.length === 3) {
            numberStart = numberStart.slice(1, numberStart.length);
        }
        if (numberStart[0] === '2' || numberStart[0] === '3' || numberStart[0] === '4' || numberStart[0] === '9') {
            zoneCode += numberStart[0] + ' ';
            numberStart = numberStart.slice(1, numberStart.length);
        }
        else {
            zoneCode += numberStart + ' ';
            numberStart = '';
        }
        return (zoneCode +
            numberStart +
            phoneNumber.slice(numberLength - 6, numberLength - 4) +
            ' ' +
            phoneNumber.slice(numberLength - 4, numberLength - 2) +
            ' ' +
            phoneNumber.slice(numberLength - 2, numberLength));
    }
    filterNationalMobileNumber(phoneNumber) {
        const numberLength = phoneNumber.length;
        let numberStart = phoneNumber.slice(0, numberLength - 6);
        if (numberStart.indexOf('0032') === 0) {
            numberStart = '0' + numberStart.slice(4, numberStart.length);
        }
        if (numberStart.indexOf('+32') === 0) {
            numberStart = '0' + numberStart.slice(3, numberStart.length);
        }
        if (numberStart.indexOf('32') === 0) {
            numberStart = '0' + numberStart.slice(2, numberStart.length);
        }
        return (numberStart +
            ' ' +
            phoneNumber.slice(numberLength - 6, numberLength - 4) +
            ' ' +
            phoneNumber.slice(numberLength - 4, numberLength - 2) +
            ' ' +
            phoneNumber.slice(numberLength - 2, numberLength));
    }
    filterBasePhoneNumber(phoneNumber) {
        const numberLength = phoneNumber.length;
        let numberStart = phoneNumber.slice(0, numberLength - 6);
        if (this.contains(numberStart, '0032')) {
            numberStart = '0' + numberStart.slice(4, numberStart.length);
        }
        if (this.contains(numberStart, '032')) {
            numberStart = '0' + numberStart.slice(3, numberStart.length);
        }
        if (this.contains(numberStart, '+32')) {
            numberStart = '0' + numberStart.slice(3, numberStart.length);
        }
        if (this.contains(numberStart, '32')) {
            numberStart = '0' + numberStart.slice(2, numberStart.length);
        }
        if (this.contains(numberStart, '00')) {
            numberStart = '0' + numberStart.slice(2, numberStart.length);
        }
        return (numberStart +
            ' ' +
            phoneNumber.slice(numberLength - 6, numberLength - 4) +
            ' ' +
            phoneNumber.slice(numberLength - 4, numberLength - 2) +
            ' ' +
            phoneNumber.slice(numberLength - 2, numberLength));
    }
    filterInternationalNumber(phoneNumber) {
        const numberStart = phoneNumber.slice(0, 2);
        if (this.contains(numberStart, '00')) {
            return '+' + phoneNumber.slice(2, phoneNumber.length);
        }
        return phoneNumber;
    }
    contains(master, test) {
        return master.indexOf(test) > -1;
    }
    static ɵfac = function PhoneNumberTransformService_Factory(t) { return new (t || PhoneNumberTransformService)(i0.ɵɵinject(i1.ConstraintsService)); };
    static ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: PhoneNumberTransformService, factory: PhoneNumberTransformService.ɵfac, providedIn: 'root' });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PhoneNumberTransformService, [{
        type: Injectable,
        args: [{
                providedIn: 'root',
            }]
    }], () => [{ type: i1.ConstraintsService }], null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGhvbmUtbnVtYmVyLXRyYW5zZm9ybS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi9waG9uZU51bWJlci9waG9uZS1udW1iZXItdHJhbnNmb3JtLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7OztBQUs3RCxNQUFNLE9BQU8sMkJBQTJCO0lBQ1Q7SUFBN0IsWUFBNkIsa0JBQXNDO1FBQXRDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7SUFBRyxDQUFDO0lBRXZFLFNBQVMsQ0FBQyxXQUFtQjtRQUMzQixJQUFJLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztZQUMzRCxPQUFPLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNyRCxDQUFDO1FBQ0QsSUFBSSxjQUFjLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7WUFDNUQsT0FBTyxJQUFJLENBQUMsMEJBQTBCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDdEQsQ0FBQztRQUNELElBQUksY0FBYyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1lBQ3ZELE9BQU8sSUFBSSxDQUFDLHFCQUFxQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ2pELENBQUM7UUFDRCxJQUFJLGNBQWMsQ0FBQywwQkFBMEIsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztZQUNoRSxPQUFPLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNyRCxDQUFDO1FBQ0QsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUVELGlCQUFpQixD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QVcsR0FBRyxHQUFHLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9ELENBQUM7UUFFRCxPQUFPLENBQ0wsV0FBVztZQUNYLEdBQUc7WUFDSCxXQUFXLENBQUMsS0FBSyxDQUFDLFlBQVksR0FBRyxDQUFDLEVBQUUsWUFBWSxHQUFHLENBQUMsQ0FBQztZQUNyRCxHQUFHO1lBQ0gsV0FBVyxDQUFDLEtBQUssQ0FBQyxZQUFZLEdBQUcsQ0FBQyxFQUFFLFlBQVksR0FBRyxDQUFDLENBQUM7WUFDckQsR0FBRztZQUNILFdBQVcsQ0FBQyxLQUFLLENBQUMsWUFBWSxHQUFHLENBQUMsRUFBRSxZQUFZLENBQUMsQ0FDbEQsQ0FBQztJQUNKLENBQUM7SUFFTyx5QkFBeUIsQ0FBQyxXQUFtQjtRQUNuRCxNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUM1QyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDckMsT0FBTyxHQUFHLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hELENBQUM7UUFDRCxPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0lBRU8sUUFBUSxDQUFDLE1BQWMsRUFBRSxJQUFZO1FBQzNDLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNuQyxDQUFDO3FGQXJJVSwyQkFBMkI7Z0VBQTNCLDJCQUEyQixXQUEzQiwyQkFBMkIsbUJBRjFCLE1BQU07O2lGQUVQLDJCQUEyQjtjQUh2QyxVQUFVO2VBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb25zdHJhaW50c1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9jb25zdHJhaW50cy9jb25zdHJhaW50cy5zZXJ2aWNlJztcbmltcG9ydCB7IFJlZ2V4Q29uc3RhbnRzIH0gZnJvbSAnLi4vY29uc3RhbnRzL3JlZ2V4LmNvbnN0YW50JztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIFBob25lTnVtYmVyVHJhbnNmb3JtU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY29uc3RyYWludHNTZXJ2aWNlOiBDb25zdHJhaW50c1NlcnZpY2UpIHt9XG5cbiAgdHJhbnNmb3JtKHBob25lTnVtYmVyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmIChSZWdleENvbnN0YW50cy5OQVRJT05BTF9QSE9ORV9OVU1CRVIudGVzdChwaG9uZU51bWJlcikpIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbHRlck5hdGlvbmFsUGhvbmVOdW1iZXIocGhvbmVOdW1iZXIpO1xuICAgIH1cbiAgICBpZiAoUmVnZXhDb25zdGFudHMuTkFUSU9OQUxfTU9CSUxFX05VTUJFUi50ZXN0KHBob25lTnVtYmVyKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyTmF0aW9uYWxNb2JpbGVOdW1iZXIocGhvbmVOdW1iZXIpO1xuICAgIH1cbiAgICBpZiAoUmVnZXhDb25zdGFudHMuQkFTRV9QSE9ORV9OVU1CRVIudGVzdChwaG9uZU51bWJlcikpIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbHRlckJhc2VQaG9uZU51bWJlcihwaG9uZU51bWJlcik7XG4gICAgfVxuICAgIGlmIChSZWdleENvbnN0YW50cy5JTlRFUk5BVElPTkFMX1BIT05FX05VTUJFUi50ZXN0KHBob25lTnVtYmVyKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZmlsdGVySW50ZXJuYXRpb25hbE51bWJlcihwaG9uZU51bWJlcik7XG4gICAgfVxuICAgIHJldHVybiBwaG9uZU51bWJlcjtcbiAgfVxuXG4gIGRvTm9ybWFsaXNlTXNpc2RuKHBob25lTnVtYmVyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGxldCB0cmFuc0Zvcm1lZE51bWJlciA9IHRoaXMudHJhbnNmb3JtKHBob25lTnVtYmVyKTtcbiAgICB0cmFuc0Zvcm1lZE51bWJlciA9IHRyYW5zRm9ybWVkTnVtYmVyLmluZGV4T2YoJzAnKSAhPT0gMCA/ICcwJyArIHRyYW5zRm9ybWVkTnVtYmVyIDogdHJhbnNGb3JtZWROdW1iZXI7XG4gICAgcmV0dXJuIHRyYW5zRm9ybWVkTnVtYmVyICYmIHRyYW5zRm9ybWVkTnVtYmVyLnJlcGxhY2UoLyAvZywgJycpO1xuICB9XG5cbiAgYXV0b0Zvcm1hdFBob25lTnVtYmVyKG1zaXNkbjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBmb3JtYXR0ZWRQaG9uZU51bWJlciA9IHRoaXMuZG9Ob3JtYWxpc2VNc2lzZG4obXNpc2RuKTtcbiAgICBpZiAoIW1zaXNkbiB8fCAhZm9ybWF0dGVkUGhvbmVOdW1iZXIpIHtcbiAgICAgIHJldHVybiBtc2lzZG47XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmNvbnN0cmFpbnRzU2VydmljZS5pc1ZhbGlkTmF0aW9uYWxNb2JpbGVOdW1iZXIoZm9ybWF0dGVkUGhvbmVOdW1iZXIpKSB7XG4gICAgICAgIHJldHVybiAwICsgZm9ybWF0dGVkUGhvbmVOdW1iZXIuc3Vic3RyaW5nKDEpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbnN0cmFpbnRzU2VydmljZS5pc1ZhbGlkSW50ZXJuYXRpb25hbE51bWJlcihtc2lzZG4pKSB7XG4gICAgICAgIHJldHVybiBtc2lzZG47XG4gICAgICB9XG4gICAgICByZXR1cm4gZm9ybWF0dGVkUGhvbmVOdW1iZXI7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJOYXRpb25hbFBob25lTnVtYmVyKHBob25lTnVtYmVyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IG51bWJlckxlbmd0aCA9IHBob25lTnVtYmVyLmxlbmd0aDtcbiAgICBsZXQgbnVtYmVyU3RhcnQgPSBwaG9uZU51bWJlci5zbGljZSgwLCBudW1iZXJMZW5ndGggLSA2KTtcbiAgICBsZXQgem9uZUNvZGUgPSAnMCc7XG4gICAgaWYgKHRoaXMuY29udGFpbnMobnVtYmVyU3RhcnQsICcwMDMyJykpIHtcbiAgICAgIG51bWJlclN0YXJ0ID0gbnVtYmVyU3RhcnQuc2xpY2UoNCwgbnVtYmVyU3RhcnQubGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY29udGFpbnMobnVtYmVyU3RhcnQsICcrMzInKSkge1xuICAgICAgbnVtYmVyU3RhcnQgPSBudW1iZXJTdGFydC5zbGljZSgzLCBudW1iZXJTdGFydC5sZW5ndGgpO1xuICAgIH1cbiAgICBpZiAobnVtYmVyU3RhcnQubGVuZ3RoID09PSAzKSB7XG4gICAgICBudW1iZXJTdGFydCA9IG51bWJlclN0YXJ0LnNsaWNlKDEsIG51bWJlclN0YXJ0Lmxlbmd0aCk7XG4gICAgfVxuICAgIGlmIChudW1iZXJTdGFydFswXSA9PT0gJzInIHx8IG51bWJlclN0YXJ0WzBdID09PSAnMycgfHwgbnVtYmVyU3RhcnRbMF0gPT09ICc0JyB8fCBudW1iZXJTdGFydFswXSA9PT0gJzknKSB7XG4gICAgICB6b25lQ29kZSArPSBudW1iZXJTdGFydFswXSArICcgJztcbiAgICAgIG51bWJlclN0YXJ0ID0gbnVtYmVyU3RhcnQuc2xpY2UoMSwgbnVtYmVyU3RhcnQubGVuZ3RoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgem9uZUNvZGUgKz0gbnVtYmVyU3RhcnQgKyAnICc7XG4gICAgICBudW1iZXJTdGFydCA9ICcnO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgem9uZUNvZGUgK1xuICAgICAgbnVtYmVyU3RhcnQgK1xuICAgICAgcGhvbmVOdW1iZXIuc2xpY2UobnVtYmVyTGVuZ3RoIC0gNiwgbnVtYmVyTGVuZ3RoIC0gNCkgK1xuICAgICAgJyAnICtcbiAgICAgIHBob25lTnVtYmVyLnNsaWNlKG51bWJlckxlbmd0aCAtIDQsIG51bWJlckxlbmd0aCAtIDIpICtcbiAgICAgICcgJyArXG4gICAgICBwaG9uZU51bWJlci5zbGljZShudW1iZXJMZW5ndGggLSAyLCBudW1iZXJMZW5ndGgpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZmlsdGVyTmF0aW9uYWxNb2JpbGVOdW1iZXIocGhvbmVOdW1iZXI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgbnVtYmVyTGVuZ3RoID0gcGhvbmVOdW1iZXIubGVuZ3RoO1xuICAgIGxldCBudW1iZXJTdGFydCA9IHBob25lTnVtYmVyLnNsaWNlKDAsIG51bWJlckxlbmd0aCAtIDYpO1xuICAgIGlmIChudW1iZXJTdGFydC5pbmRleE9mKCcwMDMyJykgPT09IDApIHtcbiAgICAgIG51bWJlclN0YXJ0ID0gJzAnICsgbnVtYmVyU3RhcnQuc2xpY2UoNCwgbnVtYmVyU3RhcnQubGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKG51bWJlclN0YXJ0LmluZGV4T2YoJyszMicpID09PSAwKSB7XG4gICAgICBudW1iZXJTdGFydCA9ICcwJyArIG51bWJlclN0YXJ0LnNsaWNlKDMsIG51bWJlclN0YXJ0Lmxlbmd0aCk7XG4gICAgfVxuICAgIGlmIChudW1iZXJTdGFydC5pbmRleE9mKCczMicpID09PSAwKSB7XG4gICAgICBudW1iZXJTdGFydCA9ICcwJyArIG51bWJlclN0YXJ0LnNsaWNlKDIsIG51bWJlclN0YXJ0Lmxlbmd0aCk7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICBudW1iZXJTdGFydCArXG4gICAgICAnICcgK1xuICAgICAgcGhvbmVOdW1iZXIuc2xpY2UobnVtYmVyTGVuZ3RoIC0gNiwgbnVtYmVyTGVuZ3RoIC0gNCkgK1xuICAgICAgJyAnICtcbiAgICAgIHBob25lTnVtYmVyLnNsaWNlKG51bWJlckxlbmd0aCAtIDQsIG51bWJlckxlbmd0aCAtIDIpICtcbiAgICAgICcgJyArXG4gICAgICBwaG9uZU51bWJlci5zbGljZShudW1iZXJMZW5ndGggLSAyLCBudW1iZXJMZW5ndGgpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZmlsdGVyQmFzZVBob25lTnVtYmVyKHBob25lTnVtYmVyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IG51bWJlckxlbmd0aCA9IHBob25lTnVtYmVyLmxlbmd0aDtcbiAgICBsZXQgbnVtYmVyU3RhcnQgPSBwaG9uZU51bWJlci5zbGljZSgwLCBudW1iZXJMZW5ndGggLSA2KTtcbiAgICBpZiAodGhpcy5jb250YWlucyhudW1iZXJTdGFydCwgJzAwMzInKSkge1xuICAgICAgbnVtYmVyU3RhcnQgPSAnMCcgKyBudW1iZXJTdGFydC5zbGljZSg0LCBudW1iZXJTdGFydC5sZW5ndGgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb250YWlucyhudW1iZXJTdGFydCwgJzAzMicpKSB7XG4gICAgICBudW1iZXJTdGFydCA9ICcwJyArIG51bWJlclN0YXJ0LnNsaWNlKDMsIG51bWJlclN0YXJ0Lmxlbmd0aCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbnRhaW5zKG51bWJlclN0YXJ0LCAnKzMyJykpIHtcbiAgICAgIG51bWJlclN0YXJ0ID0gJzAnICsgbnVtYmVyU3RhcnQuc2xpY2UoMywgbnVtYmVyU3RhcnQubGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY29udGFpbnMobnVtYmVyU3RhcnQsICczMicpKSB7XG4gICAgICBudW1iZXJTdGFydCA9ICcwJyArIG51bWJlclN0YXJ0LnNsaWNlKDIsIG51bWJlclN0YXJ0Lmxlbmd0aCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbnRhaW5zKG51bWJlclN0YXJ0LCAnMDAnKSkge1xuICAgICAgbnVtYmVyU3RhcnQgPSAnMCcgKyBudW1iZXJTdGFydC5zbGljZSgyLCBudW1iZXJTdGFydC5sZW5ndGgpO1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICBudW1iZXJTdGFydCArXG4gICAgICAnICcgK1xuICAgICAgcGhvbmVOdW1iZXIuc2xpY2UobnVtYmVyTGVuZ3RoIC0gNiwgbnVtYmVyTGVuZ3RoIC0gNCkgK1xuICAgICAgJyAnICtcbiAgICAgIHBob25lTnVtYmVyLnNsaWNlKG51bWJlckxlbmd0aCAtIDQsIG51bWJlckxlbmd0aCAtIDIpICtcbiAgICAgICcgJyArXG4gICAgICBwaG9uZU51bWJlci5zbGljZShudW1iZXJMZW5ndGggLSAyLCBudW1iZXJMZW5ndGgpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZmlsdGVySW50ZXJuYXRpb25hbE51bWJlcihwaG9uZU51bWJlcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBudW1iZXJTdGFydCA9IHBob25lTnVtYmVyLnNsaWNlKDAsIDIpO1xuICAgIGlmICh0aGlzLmNvbnRhaW5zKG51bWJlclN0YXJ0LCAnMDAnKSkge1xuICAgICAgcmV0dXJuICcrJyArIHBob25lTnVtYmVyLnNsaWNlKDIsIHBob25lTnVtYmVyLmxlbmd0aCk7XG4gICAgfVxuICAgIHJldHVybiBwaG9uZU51bWJlcjtcbiAgfVxuXG4gIHByaXZhdGUgY29udGFpbnMobWFzdGVyOiBzdHJpbmcsIHRlc3Q6IHN0cmluZykge1xuICAgIHJldHVybiBtYXN0ZXIuaW5kZXhPZih0ZXN0KSA+IC0xO1xuICB9XG59XG4iXX0=