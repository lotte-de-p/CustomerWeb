import { merge, pick } from 'lodash-es';
function setSavedState(state, localStorageKey) {
    sessionStorage.setItem(localStorageKey, JSON.stringify(state));
}
function getSavedState(localStorageKey) {
    const item = sessionStorage.getItem(localStorageKey);
    if (item) {
        return JSON.parse(item);
    }
    return {};
}
export function createStorageMetaReducer(storageKey, stateKeys) {
    return function storageMetaReducer(reducer) {
        let onInit = true; // after load/refreshâ€¦
        return function (state, action) {
            // reduce the nextState.
            const nextState = reducer(state, action);
            // init the application state.
            if (onInit) {
                onInit = false;
                const savedState = getSavedState(storageKey);
                return merge(nextState, savedState);
            }
            // save the next state to the application storage.
            const stateToSave = pick(nextState, stateKeys);
            setSavedState(stateToSave, storageKey);
            return nextState;
        };
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmFnZS5tZXRhcmVkdWNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29yZS9zdGF0ZS9zdG9yYWdlLm1ldGFyZWR1Y2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRXhDLFNBQVMsYUFBYSxDQUFDLEtBQWEsRUFBRSxlQUF1QjtJQUMzRCxjQUFjLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDakUsQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLGVBQXVCO0lBQzVDLE1BQU0sSUFBSSxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDckQsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNULE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBQ0QsT0FBTyxFQUFFLENBQUM7QUFDWixDQUFDO0FBRUQsTUFBTSxVQUFVLHdCQUF3QixDQUFDLFVBQWtCLEVBQUUsU0FBbUI7SUFDOUUsT0FBTyxTQUFTLGtCQUFrQixDQUErQixPQUE0QjtRQUMzRixJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQyxzQkFBc0I7UUFDekMsT0FBTyxVQUFVLEtBQW9CLEVBQUUsTUFBUztZQUM5Qyx3QkFBd0I7WUFDeEIsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN6Qyw4QkFBOEI7WUFDOUIsSUFBSSxNQUFNLEVBQUUsQ0FBQztnQkFDWCxNQUFNLEdBQUcsS0FBSyxDQUFDO2dCQUNmLE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDN0MsT0FBTyxLQUFLLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ3RDLENBQUM7WUFDRCxrREFBa0Q7WUFDbEQsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUMvQyxhQUFhLENBQUMsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ3ZDLE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBY3Rpb25SZWR1Y2VyLCBBY3Rpb24gfSBmcm9tICdAbmdyeC9zdG9yZSc7XG5pbXBvcnQgeyBtZXJnZSwgcGljayB9IGZyb20gJ2xvZGFzaC1lcyc7XG5cbmZ1bmN0aW9uIHNldFNhdmVkU3RhdGUoc3RhdGU6IG9iamVjdCwgbG9jYWxTdG9yYWdlS2V5OiBzdHJpbmcpIHtcbiAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShsb2NhbFN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KHN0YXRlKSk7XG59XG5cbmZ1bmN0aW9uIGdldFNhdmVkU3RhdGUobG9jYWxTdG9yYWdlS2V5OiBzdHJpbmcpOiBvYmplY3Qge1xuICBjb25zdCBpdGVtID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShsb2NhbFN0b3JhZ2VLZXkpO1xuICBpZiAoaXRlbSkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKGl0ZW0pO1xuICB9XG4gIHJldHVybiB7fTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVN0b3JhZ2VNZXRhUmVkdWNlcihzdG9yYWdlS2V5OiBzdHJpbmcsIHN0YXRlS2V5czogc3RyaW5nW10pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIHN0b3JhZ2VNZXRhUmVkdWNlcjxTLCBBIGV4dGVuZHMgQWN0aW9uID0gQWN0aW9uPihyZWR1Y2VyOiBBY3Rpb25SZWR1Y2VyPFMsIEE+KSB7XG4gICAgbGV0IG9uSW5pdCA9IHRydWU7IC8vIGFmdGVyIGxvYWQvcmVmcmVzaOKAplxuICAgIHJldHVybiBmdW5jdGlvbiAoc3RhdGU6IFMgfCB1bmRlZmluZWQsIGFjdGlvbjogQSk6IFMge1xuICAgICAgLy8gcmVkdWNlIHRoZSBuZXh0U3RhdGUuXG4gICAgICBjb25zdCBuZXh0U3RhdGUgPSByZWR1Y2VyKHN0YXRlLCBhY3Rpb24pO1xuICAgICAgLy8gaW5pdCB0aGUgYXBwbGljYXRpb24gc3RhdGUuXG4gICAgICBpZiAob25Jbml0KSB7XG4gICAgICAgIG9uSW5pdCA9IGZhbHNlO1xuICAgICAgICBjb25zdCBzYXZlZFN0YXRlID0gZ2V0U2F2ZWRTdGF0ZShzdG9yYWdlS2V5KTtcbiAgICAgICAgcmV0dXJuIG1lcmdlKG5leHRTdGF0ZSwgc2F2ZWRTdGF0ZSk7XG4gICAgICB9XG4gICAgICAvLyBzYXZlIHRoZSBuZXh0IHN0YXRlIHRvIHRoZSBhcHBsaWNhdGlvbiBzdG9yYWdlLlxuICAgICAgY29uc3Qgc3RhdGVUb1NhdmUgPSBwaWNrKG5leHRTdGF0ZSwgc3RhdGVLZXlzKTtcbiAgICAgIHNldFNhdmVkU3RhdGUoc3RhdGVUb1NhdmUsIHN0b3JhZ2VLZXkpO1xuICAgICAgcmV0dXJuIG5leHRTdGF0ZTtcbiAgICB9O1xuICB9O1xufVxuIl19