"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateOptions = void 0;
const semver_1 = require("semver");
const angular_version_utils_1 = require("../../utilities/angular-version-utils");
function validateOptions(options) {
    const { major: angularMajorVersion, version: angularVersion } = (0, angular_version_utils_1.getInstalledAngularVersionInfo)();
    if (angularMajorVersion < 17) {
        throw new Error(`The "application" executor requires Angular version 17 or greater. You are currently using version ${angularVersion}.`);
    }
    if (options.loader && (0, semver_1.lt)(angularVersion, '17.1.0')) {
        throw new Error(`The "loader" option requires Angular version 17.1.0 or greater. You are currently using version ${angularVersion}.`);
    }
    if (options.indexHtmlTransformer && (0, semver_1.lt)(angularVersion, '17.1.0')) {
        throw new Error(`The "indexHtmlTransformer" option requires Angular version 17.1.0 or greater. You are currently using version ${angularVersion}.`);
    }
    if (typeof options.index === 'object' &&
        options.index.preloadInitial !== undefined &&
        (0, semver_1.lt)(angularVersion, '17.1.0')) {
        throw new Error(`The "index.preloadInitial" option requires Angular version 17.1.0 or greater. You are currently using version ${angularVersion}.`);
    }
    if (options.optimization &&
        typeof options.optimization !== 'boolean' &&
        options.optimization.styles &&
        typeof options.optimization.styles !== 'boolean' &&
        (0, semver_1.lt)(angularVersion, '17.1.0')) {
        if (options.optimization.styles.removeSpecialComments === false) {
            throw new Error(`The "optimization.styles.removeSpecialComments" option requires Angular version 17.1.0 or greater. You are currently using version ${angularVersion}.`);
        }
        else if (options.optimization.styles.removeSpecialComments === true) {
            // silently remove the option, as it was the default before 17.1.0
            delete options.optimization.styles.removeSpecialComments;
        }
    }
    if (typeof options.outputPath === 'object' && (0, semver_1.lt)(angularVersion, '17.1.0')) {
        throw new Error(`The "outputPath" option as an object requires Angular version 17.1.0 or greater. You are currently using version ${angularVersion}.`);
    }
}
exports.validateOptions = validateOptions;
