"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nx/devkit");
const executor_options_utils_1 = require("@nx/devkit/src/generators/executor-options-utils");
async function replaceE2EExecutor(tree) {
    const projects = (0, devkit_1.getProjects)(tree);
    for (const executor of ['@nx/plugin:e2e', '@nrwl/nx-plugin:e2e']) {
        (0, executor_options_utils_1.forEachExecutorOptions)(tree, executor, (options, project, target, configuration) => {
            const projectConfiguration = projects.get(project);
            const config = {
                ...options,
                target: undefined,
                runInBand: true,
            };
            if (configuration) {
                projectConfiguration.targets[target].configurations[configuration] =
                    config;
            }
            else {
                projectConfiguration.targets[target].dependsOn = [
                    ...(projectConfiguration.targets[target].dependsOn ?? []),
                    options.target,
                ];
                projectConfiguration.targets[target].executor = '@nx/jest:jest';
                projectConfiguration.targets[target].options = config;
            }
            (0, devkit_1.updateProjectConfiguration)(tree, project, projectConfiguration);
        });
    }
    await (0, devkit_1.formatFiles)(tree);
}
exports.default = replaceE2EExecutor;
