"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nx/devkit");
const build = require("@storybook/core-server");
const utilities_1 = require("../../utils/utilities");
async function buildStorybookExecutor(options, context) {
    (0, utilities_1.storybookConfigExistsCheck)(options.configDir, context.projectName);
    const storybook7 = (0, utilities_1.storybookMajorVersion)() >= 7;
    if (!storybook7) {
        throw (0, utilities_1.pleaseUpgrade)();
    }
    const buildOptions = options;
    devkit_1.logger.info(`NX Storybook builder starting ...`);
    await runInstance(buildOptions);
    devkit_1.logger.info(`NX Storybook builder finished ...`);
    devkit_1.logger.info(`NX Storybook files available in ${buildOptions.outputDir}`);
    return { success: true };
}
exports.default = buildStorybookExecutor;
function runInstance(options) {
    const env = process.env.NODE_ENV ?? 'production';
    process.env.NODE_ENV = env;
    return build.build({
        ...options,
        mode: 'static',
    });
}
