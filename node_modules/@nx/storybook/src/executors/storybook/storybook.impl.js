"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const build = require("@storybook/core-server");
const utilities_1 = require("../../utils/utilities");
async function* storybookExecutor(options, context) {
    const storybook7 = (0, utilities_1.storybookMajorVersion)() >= 7;
    if (!storybook7) {
        throw (0, utilities_1.pleaseUpgrade)();
    }
    (0, utilities_1.storybookConfigExistsCheck)(options.configDir, context.projectName);
    const buildOptions = options;
    const result = await runInstance(buildOptions);
    yield {
        success: true,
        info: {
            port: result?.['port'],
            baseUrl: `${options.https ? 'https' : 'http'}://${options.host ?? 'localhost'}:${result?.['port']}`,
        },
    };
    await new Promise(() => { });
}
exports.default = storybookExecutor;
function runInstance(options) {
    const env = process.env.NODE_ENV ?? 'development';
    process.env.NODE_ENV = env;
    return build.build({
        ...options,
        mode: 'dev',
    });
}
