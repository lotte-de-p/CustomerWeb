"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nx/devkit");
const versions_1 = require("../../utils/versions");
// Add @nx/webpack as needed.
// See: https://github.com/nrwl/nx/issues/14455
async function update(tree) {
    const projects = (0, devkit_1.getProjects)(tree);
    const reactPlugin = '@nrwl/react/plugins/storybook';
    let shouldInstall = false;
    for (const [, config] of projects) {
        let sbConfigPath = (0, devkit_1.joinPathFragments)(config.root, '.storybook/main.ts');
        if (!tree.exists(sbConfigPath)) {
            sbConfigPath = (0, devkit_1.joinPathFragments)(config.root, '.storybook/main.js');
        }
        if (!tree.exists(sbConfigPath)) {
            continue;
        }
        const sbConfig = tree.read(sbConfigPath, 'utf-8');
        if (sbConfig.includes(reactPlugin)) {
            shouldInstall = true;
            break;
        }
    }
    if (shouldInstall) {
        return (0, devkit_1.addDependenciesToPackageJson)(tree, {}, { '@nrwl/webpack': versions_1.nxVersion });
    }
}
exports.default = update;
