"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nx/devkit");
async function default_1(tree) {
    const projects = (0, devkit_1.getProjects)(tree);
    const reactPlugin = '@nx/react/plugins/storybook';
    let shouldIgnoreReactPlugin = false;
    for (const [, config] of projects) {
        let sbConfigPath = (0, devkit_1.joinPathFragments)(config.root, '.storybook/main.ts');
        if (!tree.exists(sbConfigPath)) {
            sbConfigPath = (0, devkit_1.joinPathFragments)(config.root, '.storybook/main.js');
        }
        if (!tree.exists(sbConfigPath)) {
            continue;
        }
        const sbConfig = tree.read(sbConfigPath, 'utf-8');
        if (sbConfig.includes(reactPlugin)) {
            shouldIgnoreReactPlugin = true;
            break;
        }
    }
    if (shouldIgnoreReactPlugin && tree.exists('.eslintrc.json')) {
        (0, devkit_1.updateJson)(tree, '.eslintrc.json', (json) => {
            if (json.extends?.includes('plugin:storybook/recommended')) {
                json.rules ??= {};
                json.rules['storybook/no-uninstalled-addons'] = [
                    'error',
                    {
                        ignore: ['@nx/react/plugins/storybook'],
                    },
                ];
            }
            return json;
        });
    }
    await (0, devkit_1.formatFiles)(tree);
}
exports.default = default_1;
